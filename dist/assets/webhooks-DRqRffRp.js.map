{"version":3,"file":"webhooks-DRqRffRp.js","sources":["../../pages/webhooks.md"],"sourcesContent":["# Webhook Implementation Guide\r\n\r\nThis document provides details about the webhook system implementation in ARP Digital GPS.\r\n\r\n## Overview\r\n\r\nThe webhook system sends real-time notifications to user-configured endpoints when specific events occur in the platform. This allows clients to stay updated on transaction status changes and other important events without polling the API.\r\n\r\n## Supported Events\r\n\r\n| Event                   | Description                        | Trigger                                   |\r\n| ----------------------- | ---------------------------------- | ----------------------------------------- |\r\n| `transaction.completed` | Transaction successfully completed | When transaction status becomes COMPLETED |\r\n| `transaction.failed`    | Transaction failed                 | When transaction status becomes FAILED    |\r\n\r\n## API Endpoints\r\n\r\n| Method | Endpoint        | Description                              | Response                                  |\r\n| ------ | --------------- | ---------------------------------------- | ----------------------------------------- |\r\n| GET    | `/webhooks`     | List all webhooks for authenticated user | Array of webhook objects without secrets  |\r\n| POST   | `/webhooks`     | Create a new webhook with URL            | Webhook object including generated secret |\r\n| DELETE | `/webhooks/:id` | Delete a webhook by ID                   | Success confirmation                      |\r\n\r\nThe webhook object structure:\r\n\r\n```json\r\n{\r\n  \"id\": \"webhook_uuid\",\r\n  \"url\": \"https://your-endpoint.com/webhook\",\r\n  \"secret\": \"32bytesecretinhexformat\", // Only included in create response\r\n  \"isActive\": true,\r\n  \"createdAt\": \"2025-01-15T10:30:01Z\",\r\n  \"updatedAt\": \"2025-01-15T10:30:01Z\"\r\n}\r\n```\r\n\r\n## Webhook Payload Structure\r\n\r\nAll webhooks send a consistent JSON payload:\r\n\r\n```json\r\n{\r\n  \"event\": \"transaction.completed\",\r\n  \"data\": {\r\n    // Event-specific data (see schemas below)\r\n  },\r\n  \"timestamp\": \"2024-01-15T10:30:01Z\",\r\n  \"webhook_id\": \"webhook_xyz789\"\r\n}\r\n```\r\n\r\n### Transaction Events Data Schema\r\n\r\n```json\r\n{\r\n  \"id\": \"transaction_id\",\r\n  \"status\": \"COMPLETED|FAILED|etc\",\r\n  \"fromCurrency\": \"USD\",\r\n  \"toCurrency\": \"PHP\",\r\n  \"fromAmount\": \"100.00\",\r\n  \"toAmount\": \"5500.00\",\r\n  \"sender\": {\r\n    \"id\": \"sender_id\",\r\n    \"email\": \"sender@example.com\",\r\n    \"type\": \"INDIVIDUAL|BUSINESS\"\r\n  },\r\n  \"recipient\": {\r\n    \"id\": \"recipient_id\",\r\n    \"name\": \"Recipient Name\",\r\n    \"email\": \"recipient@example.com\",\r\n    \"type\": \"INDIVIDUAL|BUSINESS\"\r\n  },\r\n  \"notes\": \"Error message (for failed transactions)\",\r\n  \"createdAt\": \"2024-01-15T10:25:00Z\",\r\n  \"updatedAt\": \"2024-01-15T10:30:00Z\",\r\n  \"completedAt\": \"2024-01-15T10:30:00Z\" // Only for completed transactions\r\n}\r\n```\r\n\r\n## Security\r\n\r\n### Signature Verification\r\n\r\nEach webhook includes security headers:\r\n\r\n- `X-Webhook-Signature`: HMAC SHA256 signature of the payload\r\n- `X-Webhook-Event`: Event type for quick filtering\r\n- `X-Webhook-ID`: Webhook configuration ID\r\n- `User-Agent`: Always \"ARP-Digital-GPS-Webhook/1.0\"\r\n\r\n### Signature Generation\r\n\r\n```javascript\r\nconst signature = crypto\r\n  .createHmac(\"sha256\", webhook_secret)\r\n  .update(JSON.stringify(payload))\r\n  .digest(\"hex\");\r\n```\r\n\r\n### Verification Example\r\n\r\n```javascript\r\nfunction verifyWebhookSignature(payload, signature, secret) {\r\n  const expectedSignature = crypto\r\n    .createHmac(\"sha256\", secret)\r\n    .update(payload)\r\n    .digest(\"hex\");\r\n\r\n  return signature === expectedSignature;\r\n}\r\n```\r\n\r\n### Webhook Delivery\r\n\r\nWebhooks are delivered using HTTP POST requests with the following characteristics:\r\n\r\n- JSON payload in the request body\r\n- Standard headers including content-type, webhook signature, event type, and webhook ID\r\n- Requests are made using the internal `fetcher` utility that handles HTTP requests\r\n- Responses are logged but don't affect the transaction flow\r\n\r\n```javascript\r\n// Example of webhook request sent\r\nconst response = await fetcher(webhook.url, {\r\n  method: \"POST\",\r\n  data: payload,\r\n  headers: {\r\n    \"X-Webhook-Signature\": signature,\r\n    \"X-Webhook-Event\": event,\r\n    \"X-Webhook-ID\": webhook.id,\r\n    \"User-Agent\": \"ARP-Digital-GPS-Webhook/1.0\",\r\n  },\r\n});\r\n```\r\n\r\n## Webhook Response Requirements\r\n\r\nWhen your endpoint receives a webhook, it should:\r\n\r\n1. **Verify the signature** using the steps outlined in the Security section\r\n2. **Process the webhook data** according to your application's needs\r\n3. **Respond with:**\r\n   - HTTP status code `200 OK` to acknowledge receipt\r\n   - Content-Type header set to `application/json`\r\n   - A JSON response body (can be a simple confirmation like `{\"received\": true}`)\r\n\r\nExample response:\r\n\r\n```http\r\nHTTP/1.1 200 OK\r\nContent-Type: application/json\r\n\r\n{\r\n  \"received\": true,\r\n  \"timestamp\": \"2025-07-09T14:23:45Z\"\r\n}\r\n```\r\n\r\nFailure to respond properly may result in delivery retries or other issues in future versions of the API.\r\n"],"names":["_jsx","_components"],"mappings":"ozCAAE,SAAA;aAEF,SAAA;4BAEG,SAAA;aAEH,SAAA;oCAEG,SAAA;uFAED,SAAA,sBAA0B,SAAA,4BAAqC,SAAA,mHAE/D,SAAA,wCAA0B,SAAA,mDAAqC,SAAA,yHAC/D,SAAA,qCAA0B,SAAA,mCAAqC,SAAA;iCAE9D,SAAA;uFAED,SAAA,uBAAS,SAAA,yBAAkB,SAAA,4BAA2C,SAAA,+EAEtE,SAAA,yDAAS,SAAA,4BAAkB,SAAA,yDAA2C,SAAA,mFACtE,SAAA,0DAAS,SAAA,4BAAkB,SAAA,8CAA2C,SAAA,oFACtE,SAAA,4DAAS,SAAA,gCAAkB,SAAA,uCAA2C,SAAA;aAExE,SAAA;;;;;;;;;6CAaG,SAAA;aAEH,SAAA;;;;;;;;;kDAaI,SAAA;;;;;;;;;;;;;;;;;;;;;;;;4BA4BD,SAAA;0CAEC,SAAA;aAEJ,SAAA;;qDAEE,SAAA,qBAAqB,CAAA,EAAA,wCAAA;qDACrB,SAAA,iBAAiB,CAAA,EAAA,kCAAA;qDACjB,SAAA,cAAc,CAAA,EAAA,4BAAA;qDACd,SAAA,YAAY,CAAA,EAAA,wCAAA;;wCAEV,SAAA;;;;;wCASA,SAAA;;;;;;;;;oCAaA,SAAA;aAEJ,SAAA;;cAEE,SAAA;cACA,SAAA;eACA,SAAA,CAAA,wCAAAA,MAAAC,EAAA,KAAA,eAAqC,SAAA,SAAS,CAAA,EAAA,qCAAA;cAC9C,SAAA;;;;;;;;;;;;;iDAgBC,SAAA;aAEH,SAAA;;yCAEK,SAAA,sBAAsB,CAAA,EAAA,mDAAA;yCACtB,SAAA,0BAA0B,CAAA,EAAA,wCAAA;yCAC1B,SAAA;;eACA,SAAA,CAAA,oBAAAD,MAAAC,EAAA,KAAA,eAAiB,SAAA,QAAQ,CAAA,EAAA,yBAAA;eACzB,SAAA,CAAA,8BAAAD,MAAAC,EAAA,KAAA,eAA2B,SAAA;eAC3B,SAAA,CAAA,2DAAAD,MAAAC,EAAA,KAAA,eAAwD,SAAA,oBAAoB,CAAA,EAAA,GAAA;;;;aAEjF,SAAA;;;;;;;;aAYA,SAAA"}